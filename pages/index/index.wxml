<!-- pages/index/index.wxml -->
<view class="container">
  <view class="header">
    <view class="user-info-card" style="position: relative; left: -14rpx; top: -106rpx">
      <block wx:if="{{!hasUserInfo}}">
        <button class="login-btn" bindtap="navigateToLogin">ç™»å½•/æ³¨å†Œ</button>
      </block>
      <block wx:else>
        <view class="user-info-table">
          <view class="user-info-row">
            <view class="user-info-cell user-avatar-cell">
              <image class="userinfo-avatar" src="{{userInfo.photo || '/images/chat.png'}}" mode="cover"></image>
            </view>
            <view class="user-info-cell">
              <view class="info-item">
                <text class="info-label">ç”¨æˆ·åï¼š</text>
                <text class="info-value">{{userInfo.name || userInfo.id}}</text>
              </view>
              <view class="info-item" wx:if="{{userInfo.email}}">
                <text class="info-label">é‚®ç®±ï¼š</text>
                <text class="info-value">{{userInfo.email}}</text>
              </view>
              <view class="info-item">
                <text class="info-label">çŠ¶æ€ï¼š</text>
                <text class="info-value status-value {{aiStatus === 'åœ¨çº¿' ? 'online' : 'offline'}}">{{aiStatus}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>
  
  <!-- å­©å­ä¿¡æ¯å·²ç§»è‡³ä¸“é—¨é¡µé¢ï¼Œé€šè¿‡å¿«æ·æ“ä½œåŒºåŸŸçš„æŒ‰é’®è®¿é—® -->
  
  <!-- ä¿®æ”¹å¿«æ·æ“ä½œåŒºåŸŸï¼Œä½¿ç”¨ç½‘æ ¼å¸ƒå±€æ”¯æŒæ›´å¤šæŒ‰é’® -->
  <view class="quick-actions" style="width: 585rpx; display: flex; box-sizing: border-box; position: relative; left: 0rpx; top: -135rpx">
    <!-- ç¬¬ä¸€æ’æŒ‰é’® -->
    <view class="action-row">
      <view class="action-item" bindtap="navigateToChildProfile">
        <view class="action-icon">ğŸ‘¶</view>
        <text class="action-text">å­©å­ä¿¡æ¯</text>
      </view>
      <view class="action-item" bindtap="navigateToConversations">
        <view class="action-icon">ğŸ“</view>
        <text class="action-text">å¯¹è¯è®°å½•</text>
      </view>
      <view class="action-item" bindtap="navigateToMaterials">
        <view class="action-icon">ğŸ“¤</view>
        <text class="action-text">å­¦ä¹ ææ–™</text>
      </view>
      <view class="action-item" bindtap="navigateToInstructions">
        <view class="action-icon">ğŸ“¢</view>
        <text class="action-text">å‘é€æŒ‡ä»¤</text>
      </view>
    </view>
    
    <!-- ç¬¬äºŒæ’æŒ‰é’® -->
    <view class="action-row">
      <view class="action-item" bindtap="navigateToFeatureFive">
        <view class="action-icon">ğŸ”</view>
        <text class="action-text">åŠŸèƒ½äº”</text>
      </view>
      <view class="action-item" bindtap="navigateToFeatureSix">
        <view class="action-icon">ğŸ“Š</view>
        <text class="action-text">åŠŸèƒ½å…­</text>
      </view>
      <view class="action-item" bindtap="navigateToFeatureSeven">
        <view class="action-icon">ğŸ“…</view>
        <text class="action-text">åŠŸèƒ½ä¸ƒ</text>
      </view>
      <view class="action-item" bindtap="navigateToMore">
        <view class="action-icon">â‹¯</view>
        <text class="action-text">å…¶ä»–</text>
      </view>
    </view>
  </view>
  
  <!-- æœ€è¿‘å¯¹è¯è®°å½•åŒºåŸŸ - æ”¾ç½®åœ¨åº•éƒ¨ -->
  <view class="recent-conversations" style="position: relative; left: -1rpx; top: 43rpx; height: 600rpx; display: flex; box-sizing: border-box">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘å¯¹è¯</text>
      <text class="view-all" bindtap="navigateToConversations">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <scroll-view scroll-y class="chat-scroll-container">
      <view class="chat-list">
        <block wx:if="{{recentConversations.length > 0}}">
          <view wx:for="{{recentConversations}}" wx:key="id" class="chat-item {{item.speaker === 'user' ? 'user' : 'ai'}}">
            <view class="chat-time" wx:if="{{index === 0 || recentConversations[index].create_date - recentConversations[index-1].create_date > 300000}}">
              {{formatTime(item.create_date)}}
            </view>
            <view class="chat-content">
              <view class="chat-bubble {{item.speaker === 'user' ? 'user' : 'ai'}}">{{item.content || 'æ— å†…å®¹'}}</view>
            </view>
          </view>
        </block>
        <view class="empty-list" wx:else>
          <text>æš‚æ— å¯¹è¯è®°å½•</text>
        </view>
      </view>
    </scroll-view>
  </view>
</view>
