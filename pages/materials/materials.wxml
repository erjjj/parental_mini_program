<!-- pages/materials/materials.wxml -->
<view class="container">
  <view class="header">
    <text class="title">å­¦ä¹ ææ–™</text>
  </view>
  
  <!-- æœç´¢æ  -->
    <view class="search-bar">
    <view class="search-input-wrapper">
        <icon type="search" size="14" color="#999"></icon>
        <input class="search-input" placeholder="æœç´¢å­¦ä¹ ææ–™" bindinput="onSearchInput" confirm-type="search" bindconfirm="onSearch"></input>
    </view>
    <view class="upload-btn" bindtap="showUploadOptions">
        <text class="upload-icon">+</text>
    </view>
    </view>
  
<!-- åˆ†ç±»å¯¼èˆª -->
<view class="category-tabs">
  <view class="category-item {{selectedCategory === 'å…¨éƒ¨' ? 'active' : ''}}" bindtap="changeCategory" data-category="å…¨éƒ¨">å…¨éƒ¨</view>
  <view class="category-item {{selectedCategory === category ? 'active' : ''}}" 
        wx:for="{{categories}}" wx:for-item="category" wx:key="*this" 
        bindtap="changeCategory" data-category="{{category}}">
    {{category}}
  </view>
</view>
  
  <!-- å®˜æ–¹æ¨èåŒºåŸŸ -->
  <view class="official-section" wx:if="{{officialMaterials.length > 0}}">
    <view class="section-header">
      <text class="section-title">å®˜æ–¹æ¨è</text>
      <text class="view-more" bindtap="viewMoreOfficial">æŸ¥çœ‹æ›´å¤š</text>
    </view>
    <scroll-view class="official-scroll" scroll-x="true">
      <view class="official-list">
        <view class="official-item" wx:for="{{officialMaterials}}" wx:key="id" bindtap="viewOfficialDetail" data-id="{{item.id}}">
          <image class="official-cover" src="{{item.coverUrl || '/images/default_cover.png'}}"></image>
          <view class="official-info">
            <text class="official-title">{{item.title}}</text>
            <text class="official-category">{{item.category}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- æˆ‘çš„ä¸Šä¼ åŒºåŸŸ -->
  <view class="my-uploads-section">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„ä¸Šä¼ </text>
      <text class="sort-btn" bindtap="toggleSortOrder">{{sortOrder === 'time' ? 'æŒ‰æ—¶é—´æ’åº' : 'æŒ‰åç§°æ’åº'}} â–¼</text>
    </view>
    
    <view class="material-list">
      <block wx:if="{{materials.length > 0}}">
        <view class="material-item" wx:for="{{materials}}" wx:key="id" bindtap="viewMaterialDetail" data-id="{{item.id}}">
          <view class="material-icon" style="background-color: {{getColorByType(item.fileType)}}">
            <text>{{getIconByType(item.fileType)}}</text>
          </view>
          <view class="material-info">
            <view class="material-title">{{item.title}}</view>
            <view class="material-meta">
              <text class="material-category">{{item.category}}</text>
              <text class="material-date">{{item.uploadDate}}</text>
            </view>
            <view class="material-status">
              <text class="status-tag {{item.status === 'å·²å­¦ä¹ ' ? 'learned' : 'pending'}}">{{item.status}}</text>
            </view>
          </view>
          <view class="material-actions">
            <view class="action-btn edit" catchtap="editMaterial" data-id="{{item.id}}">
              <text class="action-icon">âœï¸</text>
            </view>
            <view class="action-btn delete" catchtap="deleteMaterial" data-id="{{item.id}}">
              <text class="action-icon">ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
      </block>
      <view class="empty-list" wx:else>
        <image class="empty-icon" src="/images/empty_file.png"></image>
        <text>æš‚æ— ä¸Šä¼ ææ–™</text>
        <button class="add-btn" bindtap="showUploadOptions">ç«‹å³æ·»åŠ </button>
      </view>
    </view>
  </view>
  
  <!-- ä¸Šä¼ é€‰é¡¹å¼¹çª— -->
  <view class="modal" wx:if="{{showUploadModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ å­¦ä¹ ææ–™</text>
        <icon type="clear" size="20" bindtap="hideUploadModal"></icon>
      </view>
      <view class="upload-options">
        <view class="upload-option" bindtap="chooseFile">
          <view class="option-icon document">ğŸ“„</view>
          <text class="option-text">ä¸Šä¼ æ–‡æ¡£</text>
          <text class="option-desc">æ”¯æŒPDFã€Wordã€TXTç­‰</text>
        </view>
        <view class="upload-option" bindtap="chooseImage">
          <view class="option-icon image">ğŸ–¼ï¸</view>
          <text class="option-text">ä¸Šä¼ å›¾ç‰‡</text>
          <text class="option-desc">æ”¯æŒJPGã€PNGç­‰</text>
        </view>
        <view class="upload-option" bindtap="inputText">
          <view class="option-icon text">ğŸ“</view>
          <text class="option-text">è¾“å…¥æ–‡å­—</text>
          <text class="option-desc">ç›´æ¥è¾“å…¥æ–‡æœ¬å†…å®¹</text>
        </view>
        <view class="upload-option" bindtap="recordAudio">
          <view class="option-icon audio">ğŸ¤</view>
          <text class="option-text">å½•åˆ¶éŸ³é¢‘</text>
          <text class="option-desc">å½•åˆ¶è¯­éŸ³å†…å®¹</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ–‡æœ¬è¾“å…¥å¼¹çª— -->
  <view class="modal" wx:if="{{showTextInputModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">è¾“å…¥æ–‡æœ¬å†…å®¹</text>
        <icon type="clear" size="20" bindtap="hideTextInputModal"></icon>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">æ ‡é¢˜</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ ‡é¢˜" value="{{newMaterial.title}}" bindinput="inputTitle"></input>
        </view>
        <view class="form-item">
          <text class="form-label">åˆ†ç±»</text>
          <picker mode="selector" range="{{categories}}" value="{{categories.indexOf(newMaterial.category)}}" bindchange="selectCategory">
            <view class="picker">{{newMaterial.category}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="form-label">å†…å®¹</text>
          <textarea class="form-textarea" placeholder="è¯·è¾“å…¥å†…å®¹" value="{{newMaterial.content}}" bindinput="inputContent"></textarea>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="hideTextInputModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="saveTextMaterial">ä¿å­˜</button>
      </view>
    </view>
  </view>
  
  <!-- æ–‡ä»¶ä¸Šä¼ å¼¹çª— -->
  <view class="modal" wx:if="{{showFileUploadModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ä¸Šä¼ æ–‡ä»¶</text>
        <icon type="clear" size="20" bindtap="hideFileUploadModal"></icon>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">æ ‡é¢˜</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ ‡é¢˜" value="{{newMaterial.title}}" bindinput="inputTitle"></input>
        </view>
        <view class="form-item">
          <text class="form-label">åˆ†ç±»</text>
          <picker mode="selector" range="{{categories}}" value="{{categories.indexOf(newMaterial.category)}}" bindchange="selectCategory">
            <view class="picker">{{newMaterial.category}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="form-label">æ–‡ä»¶</text>
          <view class="file-info" wx:if="{{newMaterial.fileName}}">
            <text class="file-name">{{newMaterial.fileName}}</text>
            <text class="file-size">{{newMaterial.fileSize}}</text>
          </view>
          <button class="file-btn" bindtap="chooseFile" wx:else>é€‰æ‹©æ–‡ä»¶</button>
        </view>
        <view class="form-item">
          <text class="form-label">æè¿°(é€‰å¡«)</text>
          <textarea class="form-textarea" placeholder="è¯·è¾“å…¥æè¿°" value="{{newMaterial.description}}" bindinput="inputDescription"></textarea>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="hideFileUploadModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="uploadMaterial">ä¸Šä¼ </button>
      </view>
    </view>
  </view>
</view>